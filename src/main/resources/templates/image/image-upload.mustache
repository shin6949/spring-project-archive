<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Iter</title>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="shortcut icon" href="{{storageUrl}}/static/favicon.ico">
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/image-upload.css">
<!-- 합쳐지고 최소화된 최신 CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

<!-- 부가적인 테마 -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

<!-- 합쳐지고 최소화된 최신 자바스크립트 -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
</head>
<body>

	<div class="container">
		<div class="box">
			<div class="bigbox">
				<div>
					<img src="{{storageUrl}}/static/loginLogo.png" alt="x" class="image">
				</div>
				<br />

				<div class="text">
					<hr class="hr" />
					사진업로드
					<hr class="hr" />
				</div>
				<!-- 섬네일은 아래 주소 참고 -->
				<!-- https://medium.com/@asadise/create-thumbnail-for-an-image-in-spring-framework-49776c873ea1 -->
				<form action="/image/upload" method="post" enctype="multipart/form-data">
					<table class="table">
						<tr>
							<td><input multiple="multiple" id="input_img" type="file" name="file" placeholder="사진파일"></td>
						</tr>
						<tr>
							<td>
								<div class="img_wrap">
									<img id="img" />
								</div>
							</td>
						</tr>
						<tr>
							<td><input type="text" name="content" placeholder="게시글 내용"></td>
						</tr>
						<tr>
							<td><input type="text" name="location" value="{{location}}" placeholder="위치" readonly>
                                <div id="map" style="width:270px; height:140px;margin:0 auto;"></div>
                            </td>
						</tr>
						<tr>
							<td><input type="text" name="tags" placeholder="#태그"></td>
						</tr>
					</table>

                    <input type="hidden" name="latitude" value="{{latitude}}"/>
                    <input type="hidden" name="longitude" value="{{longitude}}"/>
					<input type="submit" value="업로드">
				</form>

			</div>
			<div class="smallbox">
				<div class=text>
					<a href="javascript:window.history.back()" class="under1">뒤로가기</a>
				</div>
			</div>
		</div>
    </div>
	<script>
		var sel_file;
		$(document).ready(function() {
			$('#input_img').on("change", handleImgFileSelect);
		});
		function handleImgFileSelect(e) {
			var files = e.target.files;
			var filesArr = Array.prototype.slice.call(files);
			filesArr.forEach(function(f) {
				if (!f.type.match("image.*")) {
					alert("확장자는 이미지 확장자만 가능합니다.");
					return;
				}
				sel_file = f;
				var reader = new FileReader();
				reader.onload = function(e) {
					$('#img').attr('src', e.target.result);
				}
				reader.readAsDataURL(f);
			});
		}
	</script>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1b29e5f1a06b5ed964627df8f7e9c4b9&libraries=services"></script>
    <script>
        // 마커를 클릭하면 장소명을 표출할 인포윈도우 입니다
        var infowindow = new kakao.maps.InfoWindow({zIndex:1});

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                mapOption = {
                    center: new kakao.maps.LatLng({{latitude}}, {{longitude}}), // 지도의 중심좌표
                    level: 3 // 지도의 확대 레벨
                };
        // 지도를 생성합니다
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // 마커 생성
        var markerPosition = new kakao.maps.LatLng({{latitude}}, {{longitude}})

        var marker = new kakao.maps.Marker({
            position: markerPosition
        })
        // 마커 표시
        marker.setMap(map);
        //인포윈도우 내용,위치
        var iwContent = '<div style="padding:5px; font-size:12px;">{{location}}</div>',
                iwPosition = new kakao.maps.LatLng({{latitude}}, {{longitude}})
        //윈포윈도우 생성
        var infowinodw = new kakao.maps.InfoWindow({
            position : iwPosition,
            content : iwContent
        })
        //마커 위 윈포윈도우 표시
        infowinodw.open(map, marker);

    </script>
	{{>layout/footer}}